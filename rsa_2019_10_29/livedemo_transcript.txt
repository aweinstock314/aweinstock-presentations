>>> 2+2
4
>>> from codecs import encode
>>> from gmpy import invert, next_prime
>>> import os
>>> d = 0
>>> while d == 0:
...     p = next_prime(int(encode(os.urandom(1024/8), 'hex'), 16))
...     q = next_prime(int(encode(os.urandom(1024/8), 'hex'), 16))
...     n = p * q
...     phi = (p - 1) * (q - 1)
...     e = 3
...     d = invert(e, phi)
...
>>> message = int(encode('hello', 'hex'), 16)
>>> ciphertext = pow(message, e, n)
>>> assert pow(ciphertext, d, n) == message
>>> assert round(ciphertext**(1.0/3)) == message
>>> p
mpz(10197276811721997591105547752065947795513595851587397568543539470089502653280906290157991949594846477357205348045398480429575731249999211758201083192274597603129933216839493394463796969011922025300393353939054935998230504131931667128578625118433143892689943771960337492617049863648043307385977955012245796279L)
>>> q
mpz(138233097844231228257148959708411109551442581739810809731785515411718798607194085783498705826518136115275804501770924899138801388594214447387598976099243872241992189513198390624479932693919052366114651452265182964018576262089041725048964096764473212606126255919478421773613016112594531829861304333559576735987L)
>>> import gmpy
>>> gmpy.is_prime(p)
1
>>> gmpy.is_prime(q)
1
>>> gmpy.is_prime(phi)
0
>>> phi
mpz(1409601163259477157683265464594557426901918133112057463863775885698038184760226812795956847187270453150552309391799524641075687580554063150848798052687454445262780713763710702453990458308953523343014149658263722866523539914559991906285088094688667494614138887288169280411197880358857431473186746352747153368436874058225721637414278173850144069870157785877952147696296412717684619491510604071416460991180542463768145750473898412823445378500815596434511801149650706968158799476122788636507844873070930056181109676332819281336843841388504743489177816699506662999938749166577097239765986531864734787580323914792747460108L)
>>> e
3
>>> d
mpz(939734108839651438455510309729704951267945422074704975909183923798692123173484541863971231458180302100368206261199683094050458387036042100565865368458302963508520475842473801635993638872635682228676099772175815244349026609706661270856725396459111663076092591525446186940798586905904954315457830901831435578957916038817147758276185449233429379913438523918634765130864275145123079661007069380944307327453694975845430500315932275215630252333877064289674534099767137978772532984081859091005229915380620037454073117555212854224562560925669828992785211133004441999959166111051398159843991021243156525053549276528498306739L)
>>> import math
>>> math.log(d, 2)
inf
>>> message
448378203247
>>> hex(message)
'0x68656c6c6f'
>>> hex(message)[2:]
'68656c6c6f'
>>> hex(message)[2:].decode('hex')
'hello'
>>> ciphertext
mpz(90143305010218464651239068244550223L)
>>> message
448378203247
>>> n
mpz(1409601163259477157683265464594557426901918133112057463863775885698038184760226812795956847187270453150552309391799524641075687580554063150848798052687454445262780713763710702453990458308953523343014149658263722866523539914559991906285088094688667494614138887288169280411197880358857431473186746352747153368585304432881674863262532681310621127217113963469350354996625467599492920751985596145073158767293525056401155600290221792391822498345029255580311860441169176813280922206160672655451574536001904447596154482537057181353650607609478135666720538582413019498754948858015856505996052508107309924827606203364569992373L)
>>> e
3
>>> ciphertext**(1.0/3)
mpf('4.48378203246999328613e11')
>>> round(ciphertext**(1.0/3))
448378203247.0
>>> message
448378203247
>>> gmpy.is_prime(65537)
2
>>> gmpy.is_prime(p)
1
>>> message
448378203247
>>> e
3
>>> n
mpz(1409601163259477157683265464594557426901918133112057463863775885698038184760226812795956847187270453150552309391799524641075687580554063150848798052687454445262780713763710702453990458308953523343014149658263722866523539914559991906285088094688667494614138887288169280411197880358857431473186746352747153368585304432881674863262532681310621127217113963469350354996625467599492920751985596145073158767293525056401155600290221792391822498345029255580311860441169176813280922206160672655451574536001904447596154482537057181353650607609478135666720538582413019498754948858015856505996052508107309924827606203364569992373L)
>>> ciphertext
mpz(90143305010218464651239068244550223L)
>>> pow(message, 3, n)
mpz(90143305010218464651239068244550223L)
>>> message ** 3
90143305010218464651239068244550223L
>>> (message ** 3)**(1.0/3)
448378203246.9993
>>> message ** 65537
...
>>> len(str(message ** 65537))
763614
>>> pow(message, 65537, n)
mpz(1121781605678272103537725515169337316937384751329346545166218019434701335867952942379030980771008678484945212513325774257734468273919615503285308780396671637300301094529739318971963043910324472073093639015449102161517343422205555053126432464409517299223987564461319605643883162120857383564294478315370520554856667954611310730284530611793510224320218093656427905971560960307979323324271441398749972175844417464548960570317687234566588448025200218653076524927293493388754242458377580135393408387025002328821791913520790383847062422806378673587014567791902888019579438193185863829215120002536411510521532906687199902749L)
>>> invert(65537, phi)
mpz(63363978011847043754442529543548929301815017778478131262381307647076010380451167897476064998606874818522774973957327915415856319518932359467179746757056941815221203026502460128316155609475213692548021497676807415120898860007228529775788783846572385662042100827791121047521079017000991701176559115540734452651403496887757693269793605141561628238056133744242901370421124431486013839846044823449240796496908282317789300408869870823776951722895505547951108018170971859074962589936337264799305903475394966896707952858331714952139126855524893942644885301383136689165197598985857278611327896041526293303197190182331110937L)
>>> c2 = pow(message, 65537, n)
>>> d2 = invert(65537, phi)
>>> d2
mpz(63363978011847043754442529543548929301815017778478131262381307647076010380451167897476064998606874818522774973957327915415856319518932359467179746757056941815221203026502460128316155609475213692548021497676807415120898860007228529775788783846572385662042100827791121047521079017000991701176559115540734452651403496887757693269793605141561628238056133744242901370421124431486013839846044823449240796496908282317789300408869870823776951722895505547951108018170971859074962589936337264799305903475394966896707952858331714952139126855524893942644885301383136689165197598985857278611327896041526293303197190182331110937L)
>>> c2
mpz(1121781605678272103537725515169337316937384751329346545166218019434701335867952942379030980771008678484945212513325774257734468273919615503285308780396671637300301094529739318971963043910324472073093639015449102161517343422205555053126432464409517299223987564461319605643883162120857383564294478315370520554856667954611310730284530611793510224320218093656427905971560960307979323324271441398749972175844417464548960570317687234566588448025200218653076524927293493388754242458377580135393408387025002328821791913520790383847062422806378673587014567791902888019579438193185863829215120002536411510521532906687199902749L)
>>> pow(c2, d2, n)
mpz(448378203247)
>>> message
448378203247
>>> c2
mpz(1121781605678272103537725515169337316937384751329346545166218019434701335867952942379030980771008678484945212513325774257734468273919615503285308780396671637300301094529739318971963043910324472073093639015449102161517343422205555053126432464409517299223987564461319605643883162120857383564294478315370520554856667954611310730284530611793510224320218093656427905971560960307979323324271441398749972175844417464548960570317687234566588448025200218653076524927293493388754242458377580135393408387025002328821791913520790383847062422806378673587014567791902888019579438193185863829215120002536411510521532906687199902749L)
>>> c2 ** (1.0 / 65537)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ValueError: gmpy does not handle infinity
>>> (1.0 / 65537)
1.5258556235409006e-05
>>> from gmpy import mpf
>>> mpf(1.0)/mpf(65537)
mpf('1.52585562354090055999e-5')
>>> c2 ** (mpf(1.0)/mpf(65537))
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ValueError: mpq.pow fractional exponent, inexact-root
>>> pow(message, 3, n) * pow(message, 3, n)
mpz(8125815438165277351481140933197233052027313307864886671229139569349729L)
>>> ciphertext * ciphertext
mpz(8125815438165277351481140933197233052027313307864886671229139569349729L)
>>> pow(ciphertext * ciphertext, d, n)
mpz(201043013147008041343009L)
>>> message * message
201043013147008041343009L
>>> pow(message, 1, n)
mpz(448378203247)
>>> message
448378203247
>>> pow(message, d, n)
mpz(1115431751010443683753005741229427523519442907370781872165399994759637207740316069384379882051904082933249440455614655238793651009272764106855862822465686281502996066024214143184827985631696906442470750159343850775907310876587195172869043857379859131737492437483789129352282882644215976120964250662553560523234875293762540938517213145836131009187715601111213294247256361169695426254126014399614176664667653055816516659620442443715746089167315712112974128930636498676126568622971847617229865838281477438954827941065979583407824997861865342121014818796819662541000446688822217977266069815195986031055519362081530801615L)
>>> signature = pow(message, d, n)
>>> signature
mpz(1115431751010443683753005741229427523519442907370781872165399994759637207740316069384379882051904082933249440455614655238793651009272764106855862822465686281502996066024214143184827985631696906442470750159343850775907310876587195172869043857379859131737492437483789129352282882644215976120964250662553560523234875293762540938517213145836131009187715601111213294247256361169695426254126014399614176664667653055816516659620442443715746089167315712112974128930636498676126568622971847617229865838281477438954827941065979583407824997861865342121014818796819662541000446688822217977266069815195986031055519362081530801615L)
>>> pow(signature, e, n)
mpz(448378203247)
>>> message
448378203247
>>> e
3
>>> d
mpz(939734108839651438455510309729704951267945422074704975909183923798692123173484541863971231458180302100368206261199683094050458387036042100565865368458302963508520475842473801635993638872635682228676099772175815244349026609706661270856725396459111663076092591525446186940798586905904954315457830901831435578957916038817147758276185449233429379913438523918634765130864275145123079661007069380944307327453694975845430500315932275215630252333877064289674534099767137978772532984081859091005229915380620037454073117555212854224562560925669828992785211133004441999959166111051398159843991021243156525053549276528498306739L)
>>> signature
mpz(1115431751010443683753005741229427523519442907370781872165399994759637207740316069384379882051904082933249440455614655238793651009272764106855862822465686281502996066024214143184827985631696906442470750159343850775907310876587195172869043857379859131737492437483789129352282882644215976120964250662553560523234875293762540938517213145836131009187715601111213294247256361169695426254126014399614176664667653055816516659620442443715746089167315712112974128930636498676126568622971847617229865838281477438954827941065979583407824997861865342121014818796819662541000446688822217977266069815195986031055519362081530801615L)
>>> pow(message, d, n)
mpz(1115431751010443683753005741229427523519442907370781872165399994759637207740316069384379882051904082933249440455614655238793651009272764106855862822465686281502996066024214143184827985631696906442470750159343850775907310876587195172869043857379859131737492437483789129352282882644215976120964250662553560523234875293762540938517213145836131009187715601111213294247256361169695426254126014399614176664667653055816516659620442443715746089167315712112974128930636498676126568622971847617229865838281477438954827941065979583407824997861865342121014818796819662541000446688822217977266069815195986031055519362081530801615L)
>>> pow(pow(message, d, n), e))
  File "<stdin>", line 1
    pow(pow(message, d, n), e))
                              ^
SyntaxError: invalid syntax
>>> pow(pow(message, d, n), e, n)
mpz(448378203247)
